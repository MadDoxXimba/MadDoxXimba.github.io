<header>
    <div class="logoLeft">
         <h1>Hyblab</h1>
         <h2>Analyser la cr√©ation d'emploi du CNDS</h2>
    </div>
    <div class="menuRight">
        <ul>
            <li><a href="#intro"><img src="icons/curve_stroke.svg"><p>Emploi CNDS</p></a></li>
            <li  class="active"><a href="#pageone"><img src="icons/dot_fill.svg"><p>La carte</p></a></li>
            <li><a href="#pagetwo"><img src="icons/map_stroke.svg"><p>Les associations</p></a></li>
            <li><a href="#pagethree"><img src="icons/map_stroke.svg"><p>Remerciements</p></a></li>
        </ul>
    </div>
    <div class="infosRight">

    </div>
</header>


<div class="animated bounceInRight" ng-controller="IntroCtrl">   
    <!-- PAUWEL -->
    <style>
        #map {
        width: 100%;
        height: 100%;
        background-color: #CCC;
        }
        .nav{
            width : 100px;
            height : 200px;
        }
        .nav{
            background:#f3f2f1;
        }
        .nav ul li{
            float:left;
            list-style:none;
        }
        .nav ul li a{
            line-height:40px;
            display:inline;
            padding:0 10px;
        }
    </style>
    <div class="nav">
        <ul>
            <li><a href="" onclick="perreines()">Associations perreines</a></li>
            <li><a href="" onclick="nonperreines">Associations non perreines</a></li>
        </ul>
    </div>
    <div id="map">
            
    </div>
</div>


<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2FtZWJpcmJ5IiwiYSI6IkwwUXRVY28ifQ.ksZug_5n6Zyr-N0EqjfL9Q';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/gamebirby/cilnjnjif0035c4kncaeq95ex',
        center: [-1.54,47.248],
        zoom: 8
    });
    map.on('style.load', function () {
        /////////////// CHARGEMENT DES POINTS /////////////////////
        map.addSource("markers", association);
        map.addLayer({
            "id": "markers",
            "type": "symbol",
            "source": "markers",
            "layout": {
                "icon-image": "{marker-symbol}-15",
                "text-field": "{title}",
                "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                "text-offset": [0, 0.6],
                "text-anchor": "top"
            }
        });
        ///////////// FIN CHARGEMENT DES POINTS ///////////////////
        ///////////// CHARGEMENT DES CONTOURS DE LA LOIRE ATLANTIQUE //////////////////////
        var data_loire_atlantique = {
            "type":"geojson"
        };
        data_loire_atlantique.data = loire_atlantique;
        map.addSource("loire",data_loire_atlantique);
        map.addLayer({
            'id': 'contours',
            'type': 'line',
            'source': 'loire',
            'source-layer': 'contour',
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#2e2818',
                'line-width': 2
            }
        });
        ///////////// FIN CHARGEMENT DES CONTOURS DE LA LOIRE ATLANTIQUE ///////////////////    
    });
    
    map.on('moveend', function () {
	
        var centre = map.getCenter();

        if (centre.lng > 0.35 || centre.lng < -3 || centre.lat > 48 || centre.lat < 46.3 ){
            map.flyTo({
                center: [-1.54,47.248],
                zoom: 8.5
            });
        }

    });

    var popup = new mapboxgl.Popup();
/*
    map.on('mousemove', function (e) {
        map.featuresAt(e.point, {
            radius: 7.5
        },function (err, features){
            console.log(features);
            document.getElementById('menu').innerHTML = JSON.stringify(features, null, 2);
            
        });
    });*/
    
    var zoom = 8;
    
    map.on('click', function (e) {
        map.featuresAt(e.point, {
            radius: 7.5
        },function (err, features){
            if (zoom < 50) {
                zoom += 1;
            }
            console.log(e.lngLat.lng , e.lngLat.lat);
            map.flyTo({
                center: [e.lngLat.lng , e.lngLat.lat],
                zoom: zoom
            });
        });
    });
    
    function perreines(){
        
    }
    
    </script>



